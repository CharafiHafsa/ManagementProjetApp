{% extends 'base.html' %}


{% block content %}
{% load static %}
  <div class="container-fluid">
    <div class="card overflow-hidden chat-application">
      <div class="d-flex align-items-center justify-content-between gap-6 m-3 d-lg-none">
        <button class="btn btn-primary d-flex" type="button" data-bs-toggle="offcanvas"
          data-bs-target="#chat-sidebar" aria-controls="chat-sidebar">
          <i class="ti ti-menu-2 fs-5"></i>
        </button>
        <form class="position-relative w-100">
          <input type="text" class="form-control search-chat py-2 ps-5" id="text-srh"
            placeholder="Search Contact">
          <i class="ti ti-search position-absolute top-50 start-0 translate-middle-y fs-6 text-dark ms-3"></i>
        </form>
      </div>
      <div class="d-flex">
        <div class="w-70 w-xs-100 chat-container">
          <div class="chat-box-inner-part h-100">
            <div class="chat-not-selected h-100 d-none">
              <div class="d-flex align-items-center justify-content-center h-100 p-5">
                <div class="text-center">
                  <span class="text-primary">
                    <i class="ti ti-message-dots fs-10"></i>
                  </span>
                  <h6 class="mt-2">Open chat from the list</h6>
                </div>
              </div>
            </div>
            <div class="chatting-box d-block">
              <div class="p-9 border-bottom chat-meta-user d-flex align-items-center justify-content-between">
                <div class="hstack gap-3 current-chat-user-name">
                  <div class="position-relative">
                    <img src="{% static 'MatDash Bootstrap Admin_files/user-3.jpg' %}" alt="user1" width="48" height="48"
                      class="rounded-circle">
                    <span class="position-absolute bottom-0 end-0 p-1 badge rounded-pill bg-success">
                      <span class="visually-hidden">New alerts</span>
                    </span>
                  </div>
                  <div>
                    <h6 class="mb-1 name fw-semibold"></h6>
                    <p class="mb-0">Away</p>
                  </div>
                </div>
                <ul class="list-unstyled mb-0 d-flex align-items-center">
                
                  <li>
                    <a class="text-dark px-2 fs-7 bg-hover-primary nav-icon-hover position-relative z-index-5"
                    href="javascript:void(0)">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="m16.1 13.359l-.528-.532zm.456-.453l.529.532zm2.417-.317l-.358.66zm1.91 1.039l-.358.659zm.539 3.255l.529.532zm-1.42 1.412l-.53-.531zm-1.326.67l.07.747zm-9.86-4.238l.528-.532zM4.002 5.746l-.749.042zm6.474 1.451l.53.532zm.157-2.654l.6-.449zM9.374 2.86l-.601.45zM6.26 2.575l.53.532zm-1.57 1.56l-.528-.531zm7.372 7.362l.529-.532zm4.567 2.394l.455-.453l-1.058-1.064l-.455.453zm1.985-.643l1.91 1.039l.716-1.318l-1.91-1.038zm2.278 3.103l-1.42 1.413l1.057 1.063l1.42-1.412zm-2.286 1.867c-1.45.136-5.201.015-9.263-4.023l-1.057 1.063c4.432 4.407 8.65 4.623 10.459 4.454zm-9.263-4.023c-3.871-3.85-4.512-7.087-4.592-8.492l-1.498.085c.1 1.768.895 5.356 5.033 9.47zm1.376-6.18l.286-.286L9.95 6.666l-.287.285zm.515-3.921L9.974 2.41l-1.201.899l1.26 1.684zM5.733 2.043l-1.57 1.56l1.058 1.064l1.57-1.56zm4.458 5.44c-.53-.532-.53-.532-.53-.53h-.002l-.003.004a1 1 0 0 0-.127.157c-.054.08-.113.185-.163.318a2.1 2.1 0 0 0-.088 1.071c.134.865.73 2.008 2.256 3.526l1.058-1.064c-1.429-1.42-1.769-2.284-1.832-2.692c-.03-.194.001-.29.01-.312q.009-.02 0-.006a.3.3 0 0 1-.03.039l-.01.01l-.01.009zm1.343 4.546c1.527 1.518 2.676 2.11 3.542 2.242c.443.068.8.014 1.071-.087a1.5 1.5 0 0 0 .42-.236l.05-.045l.007-.006l.003-.003l.001-.002s.002-.001-.527-.533c-.53-.532-.528-.533-.528-.533l.002-.002l.002-.002l.006-.005l.01-.01l.038-.03q.014-.009-.007.002c-.025.009-.123.04-.32.01c-.414-.064-1.284-.404-2.712-1.824zm-1.56-9.62C8.954 1.049 6.95.834 5.733 2.044L6.79 3.107c.532-.529 1.476-.475 1.983.202zM4.752 5.704c-.02-.346.139-.708.469-1.036L4.163 3.604c-.537.534-.96 1.29-.909 2.184zm14.72 12.06c-.274.274-.57.428-.865.455l.139 1.494c.735-.069 1.336-.44 1.784-.885zM11.006 7.73c.985-.979 1.058-2.527.229-3.635l-1.201.899c.403.539.343 1.246-.085 1.673zm9.52 6.558c.817.444.944 1.49.367 2.064l1.058 1.064c1.34-1.333.927-3.557-.71-4.446zm-3.441-.849c.384-.382 1.002-.476 1.53-.19l.716-1.317c-1.084-.59-2.428-.427-3.304.443z"/></svg>
                    </a>
                  </li>
                  
                  <li>
                    <a class="text-dark px-2 fs-7 bg-hover-primary nav-icon-hover position-relative z-index-5"
                    href="javascript:void(0)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M9.451 3.25h.098c1.602 0 2.872 0 3.876.119c1.03.122 1.88.377 2.588.96q.361.296.659.658c.582.709.837 1.557.96 2.588q.04.348.064.739c.786-.392 1.452-.714 2.007-.896c.652-.213 1.343-.299 1.98.095s.87 1.05.97 1.728c.097.655.097 1.516.097 2.551v.416c0 1.035 0 1.896-.097 2.55c-.1.679-.333 1.335-.97 1.729s-1.328.308-1.98.095c-.555-.182-1.221-.504-2.007-.896q-.023.391-.065.739c-.122 1.03-.377 1.88-.96 2.588q-.296.361-.658.659c-.709.582-1.557.837-2.588.96c-1.005.118-2.274.118-3.876.118H9.45c-1.602 0-2.872 0-3.876-.119c-1.03-.122-1.88-.377-2.588-.96a5 5 0 0 1-.659-.658c-.582-.709-.837-1.557-.96-2.588c-.118-1.005-.118-2.274-.118-3.876V11.45c0-1.602 0-2.872.119-3.876c.122-1.03.377-1.88.96-2.588a5 5 0 0 1 .658-.659c.709-.582 1.557-.837 2.588-.96C6.58 3.25 7.85 3.25 9.451 3.25m6.799 9.25v-1c0-1.662-.001-2.843-.108-3.749c-.105-.889-.304-1.415-.63-1.813a3.3 3.3 0 0 0-.45-.45c-.398-.326-.924-.525-1.813-.63c-.906-.107-2.087-.108-3.749-.108s-2.843.001-3.749.108c-.889.105-1.415.304-1.813.63a3.3 3.3 0 0 0-.45.45c-.326.398-.525.924-.63 1.813c-.107.906-.108 2.087-.108 3.749v1c0 1.662.001 2.843.108 3.749c.105.889.304 1.415.63 1.813q.203.247.45.45c.398.326.924.525 1.813.63c.906.107 2.087.108 3.749.108s2.843-.001 3.749-.108c.889-.105 1.415-.304 1.813-.63q.247-.203.45-.45c.326-.398.525-.924.63-1.813c.107-.906.108-2.087.108-3.749m1.5 1.537l.244.121c.995.498 1.666.831 2.176.998c.499.163.65.1.724.055s.198-.153.275-.673c.079-.53.081-1.28.081-2.392v-.292c0-1.113-.002-1.862-.08-2.392c-.078-.52-.202-.627-.276-.673s-.225-.108-.724.055c-.51.167-1.18.5-2.176.998l-.244.122v4.072" clip-rule="evenodd"/></svg>
                      </a> 
                    </li>
                  
                  <li>
                    <a class="text-dark px-2 fs-7 bg-hover-primary nav-icon-hover position-relative z-index-5"
                    href="javascript:void(0)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M20.75 7a.75.75 0 0 1-.75.75H4a.75.75 0 0 1 0-1.5h16a.75.75 0 0 1 .75.75m0 5a.75.75 0 0 1-.75.75H4a.75.75 0 0 1 0-1.5h16a.75.75 0 0 1 .75.75m0 5a.75.75 0 0 1-.75.75H4a.75.75 0 0 1 0-1.5h16a.75.75 0 0 1 .75.75" clip-rule="evenodd"/></svg>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="d-flex parent-chat-box">
                <div class="chat-box w-xs-100">
                  <div class="chat-box-inner p-9" data-simplebar="init">
                    <div class="simplebar-wrapper" style="margin: -20px;">
                      <div class="simplebar-height-auto-observer-wrapper">
                        <div class="simplebar-height-auto-observer"></div>
                      </div>
                      <div class="simplebar-mask">
                        <div class="simplebar-offset" style="right: 0px; bottom: 0px;">
                          <div class="simplebar-content-wrapper" tabindex="0" role="region"
                            aria-label="scrollable content" id="chat_messages_scroller" style="height: 100%; overflow: scroll;">
                            <div class="simplebar-content" style="padding: 20px;">
                                <div class="chat-list chat active-chat" data-user-id="1" id="chatMessages">
                                    {% for message in messages %}
                                        {% if message.etudiant.id != 1 %}
                                            <div class="hstack gap-3 align-items-start mb-7 justify-content-start">
                                                <img src="{{message.etudiant.photo_profil}}" alt="user8" width="40" height="40" class="rounded-circle">
                                                <div>
                                                    <h6 class="fs-2 text-muted">
                                                    {{ message.etudiant.nom }} {{ message.etudiant.prenom }}, {{ message.date_envoi }}
                                                    </h6>
                                                    <div class="p-2 text-bg-light rounded-1 d-inline-block text-dark fs-3">
                                                        {{ message.contenu }}
                                                    </div>
                                                </div>
                                            </div>
                                        {% else %}
                                            <div class="hstack gap-3 align-items-start mb-7 justify-content-end">
                                                <div class="text-end">
                                                    <h6 class="fs-2 text-muted">{{message.date_envoi}}</h6>
                                                    <div class="p-2 bg-info-subtle text-dark rounded-1 d-inline-block fs-3">
                                                        {{message.contenu}}
                                                    </div>
                                                </div>
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                               </div> 
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="simplebar-placeholder" style="width: 368px; height: 631px;"></div>
                    </div>
                    <div class="simplebar-track simplebar-horizontal" style="visibility: hidden;">
                      <div class="simplebar-scrollbar" style="width: 0px; display: none;"></div>
                    </div>
                    <div class="simplebar-track simplebar-vertical" style="visibility: hidden;">
                      <div class="simplebar-scrollbar" style="height: 0px; display: none;"></div>
                    </div>
                  </div>
                <div class="px-9 py-6 border-top chat-send-message-footer">
                    <div class="d-flex align-items-center justify-content-between">
                      <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center gap-2 w-85">
                            <a class="position-relative nav-icon-hover z-index-5" href="javascript:void(0)">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                    <g fill="none">
                                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5"/>
                                        <path stroke="currentColor" stroke-linecap="round" stroke-width="1.5" d="M9 16c.85.63 1.885 1 3 1s2.15-.37 3-1"/>
                                        <path fill="currentColor" d="M16 10.5c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5s.448-1.5 1-1.5s1 .672 1 1.5"/>
                                        <ellipse cx="9" cy="10.5" fill="currentColor" rx="1" ry="1.5"/>
                                    </g>
                                </svg>
                            </a>
                        </div>
                        <!-- <div class="d-flex align-items-center justify-content-between"> -->
                          <form method="post">
                              {% csrf_token %}
                              <input type="text" id="messageInput" class="form-control message-type-box text-muted border-0 rounded-0 p-0 ms-2" placeholder="Type a Message">
                              <button type="button" class="btn btn-primary ms-2" onclick="sendMessage()">Envoyer</button>
                          </form>
                        <!-- </div> -->
                    </div>                    
                      
                        <ul class="list-unstyled mb-0 d-flex align-items-center">
                          <li>
                            <a class="text-dark px-2 fs-7 bg-hover-primary nav-icon-hover position-relative z-index-5"
                            href="javascript:void(0)">
                              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5">
                                  <path d="m2 12.5l1.752-1.533a2.3 2.3 0 0 1 3.14.105l4.29 4.29a2 2 0 0 0 2.564.222l.299-.21a3 3 0 0 1 3.731.225L21 18.5m-6-13h3.5m0 0H22m-3.5 0V9m0-3.5V2"/>
                                  <path d="M22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12c0-1.128 0-2.122.02-3M12 2C7.286 2 4.929 2 3.464 3.464c-.424.425-.726.925-.94 1.536"/>
                                </g>
                              </svg>
                            </a>
                          </li>
                          
                          <li>
                            <a class="text-dark px-2 fs-7 bg-hover-primary nav-icon-hover position-relative z-index-5"
                            href="javascript:void(0)">
                              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                <path fill="currentColor" fill-rule="evenodd" d="M8.886 3.363c2.942-2.817 7.7-2.817 10.643 0c2.961 2.834 2.961 7.444 0 10.279l-7.948 7.608c-2.09 2-5.466 2-7.556 0a5.03 5.03 0 0 1 0-7.324l7.834-7.498a3.253 3.253 0 0 1 4.468 0a3 3 0 0 1 0 4.367l-7.89 7.554a.75.75 0 1 1-1.038-1.084l7.89-7.553a1.503 1.503 0 0 0 0-2.2a1.753 1.753 0 0 0-2.393 0L5.062 15.01a3.53 3.53 0 0 0 0 5.156c1.51 1.445 3.972 1.445 5.482 0l7.948-7.608c2.344-2.244 2.344-5.868 0-8.112c-2.363-2.261-6.206-2.261-8.57 0l-6.403 6.13A.75.75 0 0 1 2.48 9.493z" clip-rule="evenodd"/>
                              </svg>
                            </a> 
                          </li>
                          
                          <li>
                            <a class="text-dark px-2 fs-7 bg-hover-primary nav-icon-hover position-relative z-index-5"
                            href="javascript:void(0)">
                              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                <g fill="none" stroke="currentColor" stroke-width="1.5">
                                  <path d="M7 8a5 5 0 0 1 10 0v3a5 5 0 0 1-10 0z"/>
                                  <path stroke-linecap="round" d="M13 8h4m-4 3h4m3-1v1a8 8 0 1 1-16 0v-1m8 9v3"/>
                                </g>
                              </svg>
                            </a>
                          </li>
                        </ul>
                        
                      </div>                      
                  </div>
                </div>
                <div class="app-chat-offcanvas border-start">
                  <div class="custom-app-scroll mh-n100 simplebar-scrollable-y" data-simplebar="init">
                    <div class="simplebar-wrapper" style="margin: 0px;">
                      <div class="simplebar-height-auto-observer-wrapper">
                        <div class="simplebar-height-auto-observer"></div>
                      </div>
                      <div class="simplebar-mask">
                        <div class="simplebar-offset" style="right: 0px; bottom: 0px;">
                          <div class="simplebar-content-wrapper" tabindex="0" role="region"
                            aria-label="scrollable content" style="height: auto; overflow: hidden scroll;">
                            <div class="simplebar-content" style="padding: 0px;">
                              <div class="p-3 d-flex align-items-center justify-content-between">
                                <h6 class="fw-semibold mb-0 text-nowrap">
                                  Media <span class="text-muted">(36)</span>
                                </h6>
                                <a class="chat-menu d-lg-none d-block text-dark fs-6 bg-hover-primary nav-icon-hover position-relative z-index-5"
                                  href="javascript:void(0)">
                                  <i class="ti ti-x"></i>
                                </a>
                              </div>
                              <div class="offcanvas-body p-9">
                                <div class="row mb-7 text-nowrap">
                                  <div class="col-4 px-1 mb-2">
                                    <img src="{% static 'MatDash Bootstrap Admin_files/product-1.jpg' %}" width="88"
                                      height="65" alt="matdash-img" class="rounded">
                                  </div>
                                </div>
                                <div class="files-chat">
                                  <h6 class="fw-semibold mb-3 text-nowrap">
                                    Files <span class="text-muted">(36)</span>
                                  </h6>
                                  <a href="javascript:void(0)"
                                    class="hstack gap-3 file-chat-hover justify-content-between text-nowrap mb-9">
                                    <div class="d-flex align-items-center gap-3">
                                      <div class="rounded-1 text-bg-light p-6">
                                        <img src="{% static 'MatDash Bootstrap Admin_files/icon-adobe.svg' %}"
                                          alt="matdash-img" width="24" height="24">
                                      </div>
                                      <div>
                                        <h6 class="fw-semibold">
                                          service-task.pdf
                                        </h6>
                                        <div class="d-flex align-items-center gap-3 fs-2 text-muted">
                                          <span>2 MB</span>
                                          <span>2 Dec 2023</span>
                                        </div>
                                      </div>
                                    </div>
                                    <span class="position-relative nav-icon-hover download-file">
                                      <i class="ti ti-download text-dark fs-6 bg-hover-primary"></i>
                                    </span>
                                  </a>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="simplebar-placeholder" style="width: 299px; height: 627px;"></div>
                    </div>
                    <div class="simplebar-track simplebar-horizontal" style="visibility: hidden;">
                      <div class="simplebar-scrollbar" style="width: 0px; display: none;"></div>
                    </div>
                    <div class="simplebar-track simplebar-vertical" style="visibility: visible;">
                      <div class="simplebar-scrollbar"
                        style="height: 409px; transform: translate3d(0px, 0px, 0px); display: block;"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="offcanvas offcanvas-start user-chat-box chat-offcanvas" tabindex="-1" id="chat-sidebar"
          aria-labelledby="offcanvasExampleLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasExampleLabel">
              Chats
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
          </div>
          <div class="px-4 pt-9 pb-6">
            <div class="d-flex align-items-center justify-content-between mb-3">
              <div class="d-flex align-items-center">
                <div class="position-relative">
                  <img src="{% static 'MatDash Bootstrap Admin_files/user-1.jpg' %}" alt="user1" width="54" height="54"
                    class="rounded-circle">
                  <span class="position-absolute bottom-0 end-0 p-1 badge rounded-pill bg-success">
                    <span class="visually-hidden">New alerts</span>
                  </span>
                </div>
                <div class="ms-3">
                  <h6 class="fw-semibold mb-2">David McMichael</h6>
                  <p class="mb-0 fs-2">Marketing Director</p>
                </div>
              </div>
              <div class="dropdown">
                <a class="text-dark fs-6 nav-icon-hover" href="javascript:void(0)" role="button"
                  data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="ti ti-dots-vertical"></i>
                </a>
                <ul class="dropdown-menu">
                  <li>
                    <a class="dropdown-item d-flex align-items-center gap-2 border-bottom"
                      href="javascript:void(0)">
                      <span>
                        <i class="ti ti-settings fs-4"></i>
                      </span>Setting
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item d-flex align-items-center gap-2" href="javascript:void(0)">
                      <span>
                        <i class="ti ti-help fs-4"></i>
                      </span>Help
                      and feedback
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item d-flex align-items-center gap-2" href="javascript:void(0)">
                      <span>
                        <i class="ti ti-layout-board-split fs-4"></i>
                      </span>Enable split View mode
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item d-flex align-items-center gap-2 border-bottom"
                      href="javascript:void(0)">
                      <span>
                        <i class="ti ti-table-shortcut fs-4"></i>
                      </span>Keyboard
                      shortcut
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item d-flex align-items-center gap-2" href="javascript:void(0)">
                      <span>
                        <i class="ti ti-login fs-4"></i>
                      </span>Sign
                      Out
                    </a>
                  </li>
                </ul>
              </div>
            </div>
            <form class="position-relative mb-4">
              <input type="text" class="form-control search-chat py-2 ps-5" id="text-srh"
                placeholder="Search Contact">
              <i class="ti ti-search position-absolute top-50 start-0 translate-middle-y fs-6 text-dark ms-3"></i>
            </form>
            <div class="dropdown">
              <a class="text-muted fw-semibold d-flex align-items-center" href="javascript:void(0)" role="button"
                data-bs-toggle="dropdown" aria-expanded="false">
                Recent Chats<i class="ti ti-chevron-down ms-1 fs-5"></i>
              </a>
              <ul class="dropdown-menu">
                <li>
                  <a class="dropdown-item" href="javascript:void(0)">Sort by time</a>
                </li>
                <li>
                  <a class="dropdown-item border-bottom" href="javascript:void(0)">Sort by Unread</a>
                </li>
                <li>
                  <a class="dropdown-item" href="javascript:void(0)">Hide favourites</a>
                </li>
              </ul>
            </div>
          </div>
          <div class="app-chat">
            <ul class="chat-users mh-n100 simplebar-scrollable-y" data-simplebar="init">
              <div class="simplebar-wrapper" style="margin: 0px;">
                <div class="simplebar-height-auto-observer-wrapper">
                  <div class="simplebar-height-auto-observer"></div>
                </div>
                <div class="simplebar-mask">
                  <div class="simplebar-offset" style="right: 0px; bottom: 0px;">
                    <div class="simplebar-content-wrapper" tabindex="0" role="region"
                      aria-label="scrollable content" style="height: auto; overflow: hidden scroll;">
                      <div class="simplebar-content" style="padding: 0px;">
                        <li>
                          <a href="javascript:void(0)"
                            class="px-4 py-3 bg-hover-light-black d-flex align-items-start justify-content-between chat-user bg-light-subtle"
                            id="chat_user_1" data-user-id="1">
                            <div class="d-flex align-items-center">
                              <span class="position-relative">
                                <img src="{% static 'MatDash Bootstrap Admin_files/user-2.jpg' %}" alt="user1" width="48"
                                  height="48" class="rounded-circle">
                                <span class="position-absolute bottom-0 end-0 p-1 badge rounded-pill bg-success">
                                  <span class="visually-hidden">New alerts</span>
                                </span>
                              </span>
                              <div class="ms-3 d-inline-block w-75">
                                <h6 class="mb-1 fw-semibold chat-title" data-username="James Anderson">
                                  Michell Flintoff
                                </h6>
                                <span class="fs-3 text-truncate text-body-color d-block">You: Yesterdy was
                                  great...</span>
                              </div>
                            </div>
                            <p class="fs-2 mb-0 text-muted">15 mins</p>
                          </a>
                        </li>
                        <li>
                          <a href="javascript:void(0)"
                            class="px-4 py-3 bg-hover-light-black d-flex align-items-start justify-content-between chat-user"
                            id="chat_user_2" data-user-id="2">
                            <div class="d-flex align-items-center">
                              <span class="position-relative">
                                <img src="{% static 'MatDash Bootstrap Admin_files/user-2.jpg' %}" alt="user-2" width="48"
                                  height="48" class="rounded-circle">
                                <span class="position-absolute bottom-0 end-0 p-1 badge rounded-pill bg-danger">
                                  <span class="visually-hidden">New alerts</span>
                                </span>
                              </span>
                              <div class="ms-3 d-inline-block w-75">
                                <h6 class="mb-1 fw-semibold chat-title" data-username="James Anderson">
                                  Bianca Anderson
                                </h6>
                                <span class="fs-3 text-truncate text-dark fw-semibold d-block">Nice looking dress
                                  you...</span>
                              </div>
                            </div>
                            <p class="fs-2 mb-0 text-muted">30 mins</p>
                          </a>
                        </li>
                        <li>
                          <a href="javascript:void(0)"
                            class="px-4 py-3 bg-hover-light-black d-flex align-items-start justify-content-between chat-user"
                            id="chat_user_3" data-user-id="3">
                            <div class="d-flex align-items-center">
                              <span class="position-relative">
                                <img src="{% static 'MatDash Bootstrap Admin_files/user-8.jpg' %}" alt="user-8" width="48"
                                  height="48" class="rounded-circle">
                                <span class="position-absolute bottom-0 end-0 p-1 badge rounded-pill bg-warning">
                                  <span class="visually-hidden">New alerts</span>
                                </span>
                              </span>
                              <div class="ms-3 d-inline-block w-75">
                                <h6 class="mb-1 fw-semibold chat-title" data-username="James Anderson">
                                  Andrew Johnson
                                </h6>
                                <span class="fs-3 text-truncate text-body-color d-block">Sent a photo</span>
                              </div>
                            </div>
                            <p class="fs-2 mb-0 text-muted">2 hrs</p>
                          </a>
                        </li>
                        <li>
                          <a href="javascript:void(0)"
                            class="px-4 py-3 bg-hover-light-black d-flex align-items-start justify-content-between chat-user"
                            id="chat_user_4" data-user-id="4">
                            <div class="d-flex align-items-center">
                              <span class="position-relative">
                                <img src="{% static 'MatDash Bootstrap Admin_files/user-4.jpg' %}" alt="user-4" width="48"
                                  height="48" class="rounded-circle">
                                <span class="position-absolute bottom-0 end-0 p-1 badge rounded-pill bg-success">
                                  <span class="visually-hidden">New alerts</span>
                                </span>
                              </span>
                              <div class="ms-3 d-inline-block w-75">
                                <h6 class="mb-1 fw-semibold chat-title" data-username="James Anderson">
                                  Daisy Wilson
                                </h6>
                                <span class="fs-3 text-truncate text-body-color d-block">Lorem ispusm text
                                  sud...</span>
                              </div>
                            </div>
                            <p class="fs-2 mb-0 text-muted">5 days</p>
                          </a>
                        </li>
                        <li>
                          <a href="javascript:void(0)"
                            class="px-4 py-3 bg-hover-light-black d-flex align-items-start justify-content-between chat-user"
                            id="chat_user_5" data-user-id="5">
                            <div class="d-flex align-items-center">
                              <span class="position-relative">
                                <img src="{% static 'MatDash Bootstrap Admin_files/user-7.jpg' %}" alt="user1" width="48"
                                  height="48" class="rounded-circle">
                                <span class="position-absolute bottom-0 end-0 p-1 badge rounded-pill bg-success">
                                  <span class="visually-hidden">New alerts</span>
                                </span>
                              </span>
                              <div class="ms-3 d-inline-block w-75">
                                <h6 class="mb-1 fw-semibold chat-title" data-username="James Anderson">
                                  Mark, Stoinus &amp; Rishvi..
                                </h6>
                                <span class="fs-3 text-truncate text-dark fw-semibold d-block">Lorem ispusm text
                                  ...</span>
                              </div>
                            </div>
                            <p class="fs-2 mb-0 text-muted">5 days</p>
                          </a>
                        </li>
                        <li>
                          <a href="javascript:void(0)"
                            class="px-4 py-3 bg-hover-light-black d-flex align-items-start justify-content-between chat-user"
                            id="chat_user_2" data-user-id="2">
                            <div class="d-flex align-items-center">
                              <span class="position-relative">
                                <img src="{% static 'MatDash Bootstrap Admin_files/user-2.jpg' %}" alt="user-2" width="48"
                                  height="48" class="rounded-circle">
                                <span class="position-absolute bottom-0 end-0 p-1 badge rounded-pill bg-danger">
                                  <span class="visually-hidden">New alerts</span>
                                </span>
                              </span>
                              <div class="ms-3 d-inline-block w-75">
                                <h6 class="mb-1 fw-semibold chat-title" data-username="James Anderson">
                                  Bianca Anderson
                                </h6>
                                <span class="fs-3 text-truncate text-dark fw-semibold d-block">Nice looking dress
                                  you...</span>
                              </div>
                            </div>
                            <p class="fs-2 mb-0 text-muted">30 mins</p>
                          </a>
                        </li>
                        <li>
                          <a href="javascript:void(0)"
                            class="px-4 py-3 bg-hover-light-black d-flex align-items-start justify-content-between chat-user"
                            id="chat_user_3" data-user-id="3">
                            <div class="d-flex align-items-center">
                              <span class="position-relative">
                                <img src="{% static 'MatDash Bootstrap Admin_files/user-8.jpg' %}" alt="user-8" width="48"
                                  height="48" class="rounded-circle">
                                <span class="position-absolute bottom-0 end-0 p-1 badge rounded-pill bg-warning">
                                  <span class="visually-hidden">New alerts</span>
                                </span>
                              </span>
                              <div class="ms-3 d-inline-block w-75">
                                <h6 class="mb-1 fw-semibold chat-title" data-username="James Anderson">
                                  Andrew Johnson
                                </h6>
                                <span class="fs-3 text-truncate text-body-color d-block">Sent a photo</span>
                              </div>
                            </div>
                            <p class="fs-2 mb-0 text-muted">2 hrs</p>
                          </a>
                        </li>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="simplebar-placeholder" style="width: 330px; height: 560px;"></div>
              </div>
              <div class="simplebar-track simplebar-horizontal" style="visibility: hidden;">
                <div class="simplebar-scrollbar" style="width: 0px; display: none;"></div>
              </div>
              <div class="simplebar-track simplebar-vertical" style="visibility: visible;">
                <div class="simplebar-scrollbar"
                  style="height: 459px; transform: translate3d(0px, 0px, 0px); display: block;"></div>
              </div>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
<script>
    // Identifiants du groupe et de l'étudiant (à modifier selon vos besoins)
    const groupeId = 1;
    const etudiantId = 1;

    // Fonction qui établit la connexion WebSocket et configure les callbacks
    function connectWebSocket() {
        // Créer une nouvelle connexion WebSocket
        let socket = new WebSocket(`ws://${window.location.hostname}:8000/ws/chat/`);

        // Lors de l'ouverture de la connexion, envoyer l'action "join"
        socket.onopen = function() {
            console.log("✅ Connexion WebSocket établie !");
            socket.send(JSON.stringify({
                'action': 'join',
                'groupe_id': groupeId,
                'etudiant_id': etudiantId
            }));
        };

        // En cas d'erreur sur la connexion
        socket.onerror = function(error) {
            console.error("❌ Erreur WebSocket :", error);
        };

        // Lors de la fermeture de la connexion
        socket.onclose = function(event) {
            console.warn(`⚠ Connexion fermée : Code=${event.code}, Raison=${event.reason}`);
            if (event.code === 1006) {
                console.error("La connexion a été fermée de manière inattendue.");
            }
            // Tentative de reconnexion après 5 secondes
            setTimeout(function() {
                console.log("Tentative de reconnexion...");
                // Mettre à jour la variable globale "socket" avec la nouvelle connexion
                socket = connectWebSocket();
                window.socket = socket; // Mettez à jour la variable globale si nécessaire
            }, 5000);
        };

        // Lors de la réception d'un message depuis le serveur
        socket.onmessage = function(event) {
            const data = JSON.parse(event.data);
            console.log("Message reçu :", data);
            const chatMessages = document.getElementById('chatMessages');

            // Affichage des messages en fonction de l'expéditeur
            if (data.etudiant_id != etudiantId) {
                chatMessages.innerHTML += `
                    <div class="hstack gap-3 align-items-start mb-7 justify-content-start">
                        <div>
                            <h6 class="fs-2 text-muted">${data.etudiant_nom}, ${data.date_envoi}</h6>
                            <div class="p-2 text-bg-light rounded-1 d-inline-block text-dark fs-3">${data.message}</div>
                        </div>
                    </div>
                `;
            } else {
                chatMessages.innerHTML += `
                    <div class="hstack gap-3 align-items-start mb-7 justify-content-end">
                        <div class="text-end">
                            <h6 class="fs-2 text-muted">${data.date_envoi}</h6>
                            <div class="p-2 bg-info-subtle text-dark rounded-1 d-inline-block fs-3">${data.message}</div>
                        </div>
                    </div>
                `;
            }
            // Auto-scroll vers le bas
            chatMessages.scrollTop = chatMessages.scrollHeight;
        };

        return socket;
    }

    // Initialisation de la connexion et stockage dans une variable globale
    let socket = connectWebSocket();
    window.socket = socket;  // Permet de mettre à jour la variable en cas de reconnexion

    // Fonction pour envoyer un message
    function sendMessage() {
        // Vérifier que la connexion est ouverte
        if (!socket || socket.readyState !== WebSocket.OPEN) {
            console.error("La connexion WebSocket est fermée, impossible d'envoyer le message.");
            return;
        }
        const messageInput = document.getElementById('messageInput');
        const message = messageInput.value.trim();
        if (message !== '') {
            socket.send(JSON.stringify({
                'action': 'send_message',
                'message': message,
                'etudiant_id': etudiantId,
                'groupe_id': groupeId
            }));
            messageInput.value = '';  // Vide le champ après envoi
        }
    }

    // Envoyer le message lorsque l'utilisateur appuie sur la touche "Entrée"
    document.getElementById('messageInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            sendMessage();
        }
    });
</script>




{% endblock content %}
