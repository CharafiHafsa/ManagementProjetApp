{% extends 'prof/base.html' %}
{% load static %}

{% block content %}

<script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>
{% if messages %}
{% for message in messages %}
  <div class="alert alert-{{ message.tags }} fade-message">{{ message }}</div>
{% endfor %}
{% endif %}
<div class="row g-4">
    
    <div class="d-flex justify-content-between flex-wrap gap-3">
        <button class="btn btn-dashboard p-3 flex-fill selected1" onclick="changeContent('default', this)" id="default-btn">
            <span class="iconify me-2" data-icon="solar:folder-open-linear" style="font-size: 24px;"></span>
            Details
        </button>
        <button class="btn btn-dashboard p-3 flex-fill" onclick="changeContent('instruction', this)">
            <span class="iconify me-2" data-icon="solar:checklist-minimalistic-outline" style="font-size: 24px;"></span>
            Instrution
        </button>
        <button class="btn btn-dashboard p-3 flex-fill" onclick="changeContent('announce', this)">
            <span class="iconify me-2" data-icon="solar:chat-round-line-outline" style="font-size: 24px;"></span>
            Announce
        </button>
        <button class="btn btn-dashboard p-3 flex-fill" onclick="changeContent('ressource', this)">
            <span class="iconify me-2" data-icon="solar:book-bookmark-minimalistic-linear" style="font-size: 24px;"></span>
            Ressources
        </button>
        <button class="btn btn-dashboard p-3 flex-fill" onclick="changeContent('groupes', this)">
            <span class="iconify me-2" data-icon="solar:users-group-rounded-linear" style="font-size: 24px;"></span>
            Groups
        </button>
    </div>


<div class="row g-4">

    <div class="card shadow-lg p-4 bg-white border-0 raduise-for-all">
        <div id="default-view" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-3 p-3">
                <!-- Left Side: Project Dashboard -->
                <h5 class="fw-bold text-dark d-flex align-items-center">
                    <span class="iconify me-2" data-icon="solar:clipboard-list-linear" style="font-size: 24px;"></span>
                    Project Dashboard
                </h5>
            
                <!-- Right Side: Icons for Modals -->
                <div>
                    <!-- Add Project Button -->
                    <button class="btn-indisplay" data-bs-toggle="modal" data-bs-target="#editProjetModal{{ projet.id }}">
                        <span class="iconify icon-normal" data-icon="solar:pen-linear" style="font-size: 26px;"></span>
                    </button>
            
                    <!-- Delete Project Button -->
                    <button class="btn-indisplay" data-bs-toggle="modal" data-bs-target="#deleteProjetModal{{ projet.id }}">
                        <span class="iconify icon-delete" data-icon="solar:trash-bin-2-linear" style="font-size: 28px;"></span>
                    </button>
                </div>
                <div class="modal fade" id="editProjetModal{{ projet.id }}" tabindex="-1" aria-labelledby="editProjetModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content" style="border: none; border-radius: 15px; overflow: hidden;">
                            <div class="modal-header text-white" style="background-color: #635bff;">
                                <h5 class="modal-title" id="editProjetModalLabel">Editer Projet : {{ projet.nom_project }}</h5>
                                <button type="button" class="btn-close custom-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="editProjetForm" method="POST" action="{% url 'edit_projet' projet_id=projet.id %}?next={{ request.path }}">
                                    {% csrf_token %}
                                    <div class="mb-3">
                                        <label for="className{{ projet.id }}" class="form-label">Nome du projet</label>
                                        <input type="text" class="form-control" id="projetName{{ projet.id }}" name="projetName" value="{{projet.nom_project}}">
                                    </div>
                                    <div class="mb-3">
                                        <label for="projetdesc{{ projet.id }}" class="form-label">Descreption du projet</label>
                                        <input type="text" class="form-control" id="projetdesc{{ projet.id }}" name="projetdesc" value="{{projet.description}}">
                                    </div>
                                    <div class="mb-3">
                                        <label for="date_debut" class="form-label" style="color: #635bff;">
                                        <span class="iconify me-2" data-icon="solar:calendar-date-outline" style="font-size: 24px;"></span>
                                        Date de Début
                                        </label>
                                        <input type="date" class="form-control raduise-for-all" id="date_debut{{ projet.id }}" name="date_debut" value="{{ projet.date_debut|date:'Y-m-d' }}">
                                    </div>
                            
                                    <div class="mb-3">
                                        <label for="date_fin" class="form-label" style="color: #635bff;">
                                        <span class="iconify me-2" data-icon="solar:calendar-date-line-duotone" style="font-size: 24px;"></span>
                                        Date de Fin
                                        </label>
                                        <input type="date" class="form-control raduise-for-all" id="date_fin{{ projet.id }}" name="date_fin" value="{{ projet.date_fin|date:'Y-m-d' }}">
                                    </div>
                                    <div class="text-end">
                                        <button type="submit" class="btn btn-modal-style">modifier Projet</button>
                                    </div>
                                </form>
                                
                            </div>
                        </div>
                    </div>
                </div>

                            <!-- Bootstrap Modal for Delete a New Class -->
            <div class="modal fade" id="deleteProjetModal{{ projet.id }}" tabindex="-1" aria-labelledby="deleteProjetModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content" style="border: none; border-radius: 15px; overflow: hidden;">
                        <div class="modal-header text-white" style="background-color: #635bff;">
                            <h5 class="modal-title" id="editClassModalLabel">Supprimer classe : {{ classe.nom_classe }}</h5>
                            <button type="button" class="btn-close custom-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p>Êtes-vous sûr de vouloir supprimer cette classe ? La suppression du projet entraînera également la suppression de toutes les données associées (étudiants, projets, etc.).</p>
                            
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-modal-style" data-bs-dismiss="modal">Annuler</button>
                            
                            <!-- Form to submit delete request -->
                            <form method="POST" action="{% url 'delete_projet' projet_id=projet.id %}?next={{ request.path }}">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger">Oui, Supprimer</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            

            </div>
            
            <div class="container mt-4">
<!-- Project Overview and Project Statistics in separate rows -->
<div class="row">
    <!-- Project Overview Section (Project Info) -->
    <div class="col-md-12 mb-4">
        <div class="card shadow-sm border-light rounded p-3">
            <div class="card-body">
                <h5 class="card-title text-primary">
                    <span class="iconify me-2" data-icon="mdi:project-outline"></span>
                    {{ projet.nom_project }}
                </h5>
                <p class="card-text text-muted"><strong>Description:</strong> {{ projet.description }}</p>
                <small class="text-muted">
                    <strong>Timeline:</strong> {{ projet.date_debut }} - {{ projet.date_fin }}
                </small>
            </div>
        </div>
    </div>
</div>

<!-- Project Statistics Section -->
<div class="row">
    <div class="col-md-12 mb-4">
        <div class="card shadow-sm border-light rounded p-3">
            <div class="card-body text-center">
                <h5 class="card-title text-primary">
                    <span class="iconify me-2" data-icon="mdi:chart-line"></span> Project Statistics
                </h5>

                <!-- Flexbox Container for Statistics -->
                <div class="d-flex justify-content-center align-items-center gap-5 flex-wrap">
                    <!-- Total Groups -->
                    <div class="stat-container">
                        <div class="stat-circle">
                            <span class="count" data-target="{{ total_groups }}">0</span>
                        </div>
                        <p class="stat-label">Total Groups</p>
                    </div>

                    <!-- Total Students -->
                    <div class="stat-container">
                        <div class="stat-circle">
                            <span class="count" data-target="{{ total_students }}">0</span>
                        </div>
                        <p class="stat-label">Total Students</p>
                    </div>

                    <!-- Completion Percentage (Centered) -->
                    <div class="stat-container order-3">
                        <div class="progress-circle">
                            <svg viewBox="0 0 100 100">
                                <circle class="progress-bg" cx="50" cy="50" r="40"></circle>
                                <circle class="progress-bar" cx="50" cy="50" r="40" 
                                    style="stroke-dashoffset: calc(251 - ({{ completion_percentage }} * 2.51))">
                                </circle>
                            </svg>
                            <div class="progress-text">
                                <span class="count" data-target="{{ completion_percentage }}">0</span>%
                            </div>
                        </div>
                        <p class="stat-label">Completion Percentage</p>
                    </div>

                    <!-- Total Instructions -->
                    <div class="stat-container">
                        <div class="stat-circle">
                            <span class="count" data-target="{{ total_instructions }}">0</span>
                        </div>
                        <p class="stat-label">Total Instructions</p>
                    </div>

                    <!-- Completed Instructions -->
                    <div class="stat-container">
                        <div class="stat-circle">
                            <span class="count" data-target="{{ completed_instructions }}">0</span> / {{ total_instructions }}
                        </div>
                        <p class="stat-label">Completed Instructions</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



            
                <!-- Charts Section -->
<div class="row mt-4">
    <!-- Instruction Progress Chart -->
    <div class="col-md-6 mb-4">
        <div class="card shadow-sm border-light rounded p-3 h-100">
            <div class="card-body d-flex flex-column justify-content-center align-items-center">
                <h5 class="card-title text-primary text-center">
                    <span class="iconify me-2" data-icon="mdi:chart-bar"></span> Instruction Progress
                </h5>
                <div id="instructionChart" class="chart-container"></div>
            </div>
        </div>
    </div>

    <!-- Group Completion Pie Chart -->
    <div class="col-md-6 mb-4">
        <div class="card shadow-sm border-light rounded p-3 h-100">
            <div class="card-body d-flex flex-column justify-content-center align-items-center">
                <h5 class="card-title text-primary text-center">
                    <span class="iconify me-2" data-icon="mdi:chart-pie"></span> Group Participation
                </h5>
                <div id="groupChart" class="chart-container"></div>
            </div>
        </div>
    </div>
</div>

<!-- CSS Styling -->
<style>
    .chart-container {
        width: 100%;
        height: 400px;
        display: flex;
        justify-content: center;
        align-items: center;
    }
</style>

            
                <!-- Instruction Details -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card shadow-sm border-light rounded p-3">
                            <div class="card-body">
                                <h5 class="card-title text-primary">
                                    <span class="iconify me-2" data-icon="mdi:clipboard-check"></span> Instruction Details
                                </h5>
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Instruction</th>
                                            <th>Completed Groups</th>
                                            <th>Pending Groups</th>
                                            <th>Deadline</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for stat in instruction_stats %}
                                        <tr>
                                            <td>{{ stat.instruction.titre }}</td>
                                            <td>{{ stat.completed_groups }} / {{ stat.total_groups }}</td>
                                            <td>{{ stat.pending_groups }}</td>
                                            <td>{{ stat.deadline|default:"No Deadline" }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            
            </div>
            
            <!-- JavaScript for Number Animation -->
            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const counters = document.querySelectorAll(".count");
                    counters.forEach(counter => {
                        let target = +counter.getAttribute("data-target");
                        let count = 0;
                        let increment = target / 50; // Speed of counting
            
                        function updateCount() {
                            if (count < target) {
                                count += increment;
                                counter.innerText = Math.ceil(count);
                                setTimeout(updateCount, 20);
                            } else {
                                counter.innerText = target;
                            }
                        }
                        updateCount();
                    });
                });
            </script>
            
            <!-- Google Charts Library -->
            <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
            <script type="text/javascript">
                google.charts.load('current', {'packages':['corechart']});
                google.charts.setOnLoadCallback(drawCharts);
            
                function drawCharts() {
                    drawInstructionChart();
                    drawGroupChart();
                }
            
                function drawInstructionChart() {
                    var data = new google.visualization.DataTable();
                    data.addColumn('string', 'Instruction');
                    data.addColumn('number', 'Completed Groups');
                    data.addColumn('number', 'Pending Groups');
            
                    {% for stat in instruction_stats %}
                        data.addRow(["{{ stat.instruction.titre }}", {{ stat.completed_groups }}, {{ stat.pending_groups }}]);
                    {% endfor %}
            
                    var options = {
                        title: 'Instruction Completion Status',
                        chartArea: {width: '80%'},
                        colors: ['#635bff', '#aca8ff'],  // Updated colors
                        legend: { position: 'top', alignment: 'center' },
                        hAxis: {
                            title: 'Instructions',
                            minValue: 0
                        },
                        vAxis: {
                            title: 'Number of Groups'
                        },
                        bars: 'horizontal'
                    };
            
                    var chart = new google.visualization.BarChart(document.getElementById('instructionChart'));
                    chart.draw(data, options);
                }
            
                function drawGroupChart() {
                    var data = google.visualization.arrayToDataTable([
                        ['Status', 'Number of Groups'],
                        ['Completed All Instructions', {{ completed_instructions }}],
                        ['Pending Instructions', {{ pending_instructions }}]
                    ]);
            
                    var options = {
                        title: 'Overall Group Progress',
                        pieHole: 0.4,
                        colors: ['#635bff', '#aca8ff']  // Updated colors
                    };
            
                    var chart = new google.visualization.PieChart(document.getElementById('groupChart'));
                    chart.draw(data, options);
                }
            </script>
            
            
        

        </div>
        


        
        <div id="instruction-view" style="display: none;">
            <div>
                <!-- Header Section -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="fw-bold text-dark d-flex align-items-center">
                        <span class="iconify me-2 text-primary" data-icon="solar:checklist-minimalistic-outline" style="font-size: 28px;"></span>
                        Instructions
                    </h5>
                    <div class="d-flex gap-3">
                        <!-- Completed Instructions -->
                        <div class="border border-success rounded px-3 py-1 d-flex align-items-center" 
                             title="Total instructions complétés">
                            <span class="iconify text-success me-1" data-icon="solar:check-circle-bold" style="font-size: 18px;"></span>
                            <strong class="text-success">{{ completed_instructions }} / {{ total_instructions }}</strong>
                        </div>
                    
                        <!-- Pending Instructions -->
                        <div class="border border-danger rounded px-3 py-1 d-flex align-items-center" 
                             title="Total instructions non complétés">
                            <span class="iconify text-danger me-1" data-icon="solar:close-circle-bold" style="font-size: 18px;"></span>
                            <strong class="text-danger">{{ pending_instructions }} / {{ total_instructions }}</strong>
                        </div>
                    
                        <!-- Add Instruction Button -->
                        <button class="btn-indisplay d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#addInstructionModal">
                            <span class="iconify icon-normal me-2" data-icon="solar:add-square-linear"></span>
                        </button>
                    </div>
                    
                    

                </div>
        
                <hr class="text-muted mb-3">
        
                <!-- Instructions List -->
                {% if instruction_stats %}
                    <ul class="list-group list-group-flush">
                        {% for item in instruction_stats %}
                            <li class="list-group-item py-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h6 class="fw-bold text-primary d-flex align-items-center">
                                        <span class="iconify me-2" data-icon="solar:document-text-outline" style="font-size: 22px;"></span>
                                        {{ item.instruction.titre }}
                                    </h6>
                                    {% if item.instruction.livrable_requis %}
                                        <span class="badge custom-warning text-dark d-flex align-items-center px-2 py-1">
                                            <span class="iconify me-1" data-icon="solar:cloud-check-linear" style="font-size: 18px;"></span>
                                            Livrable requis
                                        </span>
                                    {% endif %}
                                </div>
        
                                <div class="mt-2 d-flex justify-content-between align-items-center flex-wrap">
                                    <!-- Statistics Section -->
                                    <div class="d-flex gap-4 text-secondary" style="font-size: 15px;">
                                        <p class="mb-0 d-flex align-items-center text-success">
                                            <span class="iconify me-1" data-icon="solar:check-read-linear"></span>
                                            <strong>Complétés:</strong> 
                                            <span class="fw-bold ms-1">{{ item.completed_groups }} / {{ item.total_groups }}</span>
                                        </p>                                        
                                        <p class="mb-0 d-flex align-items-center text-danger">
                                            <span class="iconify me-1" data-icon="solar:close-circle-outline"></span>
                                            <strong>En attente:</strong> 
                                            <span class="fw-bold ms-1">{{ item.pending_groups }} / {{ item.total_groups }}</span>
                                        </p>
                                    </div>
        
                                    <!-- Date Limit -->
                                    {% if item.instruction.date_limite %}
                                        <small class="text-danger d-flex align-items-center">
                                            <span class="iconify me-1" data-icon="solar:calendar-linear"></span>
                                            <strong>Date limite:</strong> {{ item.instruction.date_limite }}
                                        </small>
                                    {% endif %}
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-muted text-center py-3">Pas d'instructions pour ce projet.</p>
                {% endif %}
            </div>
                    <!-- Add Instruction Modal -->
        <div class="modal fade" id="addInstructionModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content" style="border: none; border-radius: 15px; overflow: hidden;">
                    <div class="modal-header text-white" style="background-color: #635bff;">
                        <h5 class="modal-title">Ajouter une instruction</h5>
                        <button type="button" class="btn-close custom-close" data-bs-dismiss="modal" aria-label="Close"></button>

                    </div>
                    <div class="modal-body">
                        <form method="post" action="{% url 'add_instruction' projet.id %}">
                            {% csrf_token %}
                            <div class="mb-3">
                                <label class="form-label">Titre</label>
                                <input type="text" name="titre" class="form-control raduise-for-all" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Date limite (optionnel)</label>
                                <input type="date" name="date_limite" class="form-control raduise-for-all">
                            </div>
                            <div class="form-check mb-3">
                                <input type="checkbox" name="livrable_requis" class="form-check-input raduise-for-all" style="border: 1px solid #635bff;">
                                <label class="form-check-label">Livrable requis</label>
                            </div>
                            <button type="submit" class="btn btn-modal-style">Ajouter</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        </div>
        
        
          
        
        

        
        <div id="announce-view" style="display: none;">
            <h5 class="fw-bold text-dark text-center mb-3">
                <span class="iconify me-2" data-icon="solar:chat-round-line-outline" style="font-size: 24px;"></span>
                Announcements
            </h5>
        
            <!-- Add Announcement Form -->
            <form method="post" action="{% url 'add_announce' projet.id %}" class="d-flex align-items-center">
                {% csrf_token %}
                <textarea name="contenu" class="form-control me-2" placeholder="Écrivez une annonce..." required></textarea>
                <button type="submit" class="btn-indisplay">
                    <span class="iconify icon-normal me-2" data-icon="solar:add-square-linear" style="font-size: 24px;"></span>
                </button>
            </form>
        
            <!-- List of Announcements -->
            <div class="mt-4">
                {% for announce in announces %}
                    <div class="card mb-3">
                        <div class="card-body d-flex justify-content-between align-items-center">
                            <p class="mb-0">{{ announce.contenu }}</p>
                            <div>
                                <!-- Edit Icon (Triggers Modal) -->
                                <button class="btn-indisplay btn-sm" data-bs-toggle="modal" data-bs-target="#editModal{{ announce.id }}">
                                    <span class="iconify icon-normal me-2" data-icon="solar:pen-linear" style="font-size: 24px;"></span>
                                </button>
        
                                <!-- Delete Icon (Triggers Confirmation Modal) -->
                                <button class="btn-indisplay btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal{{ announce.id }}">
                                    <span class="iconify icon-delete me-2" data-icon="solar:trash-bin-2-linear" style="font-size: 24px;"></span>
                                </button>
                            </div>
                        </div>
                    </div>
        
                    <!-- Edit Modal -->
                    <div class="modal fade" id="editModal{{ announce.id }}" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content" style="border: none; border-radius: 15px; overflow: hidden;">
                                <div class="modal-header text-white" style="background-color: #635bff;">
                                    <h5 class="modal-title" id="editModalLabel">Modifier l'annonce</h5>
                                    <button type="button" class="btn-close custom-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <form method="post" action="{% url 'modify_announce' announce.id %}">
                                    {% csrf_token %}
                                    <div class="modal-body">
                                        <textarea name="contenu" class="form-control">{{ announce.contenu }}</textarea>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-ret" data-bs-dismiss="modal">Annuler</button>
                                        <button type="submit" class="btn btn-form-classe">Enregistrer</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
        
                    <!-- Delete Confirmation Modal -->
                    <div class="modal fade" id="deleteModal{{ announce.id }}" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content" style="border: none; border-radius: 15px; overflow: hidden;">
                                <div class="modal-header text-white" style="background-color: #635bff;">
                                    <h5 class="modal-title" id="deleteModalLabel">Confirmer la suppression</h5>
                                    <button type="button" class="btn-close custom-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    Êtes-vous sûr de vouloir supprimer cette annonce ?
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-ret" data-bs-dismiss="modal">Annuler</button>
                                    <form method="post" action="{% url 'delete_announce' announce.id %}" class="d-inline">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-danger raduise-for-all">Supprimer</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
        
                {% empty %}
                    <p class="text-center text-muted">Aucune annonce pour ce projet.</p>
                {% endfor %}
            </div>
        </div>
        
        
        
        <div id="ressources-view" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-3 p-3">
                <h5 class="fw-bold text-dark d-flex align-items-center">
                    <span class="iconify me-2" data-icon="solar:book-bookmark-minimalistic-linear" style="font-size: 24px;"></span>
                    Ressources
                </h5>
                <button class="btn-indisplay d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#addRessourceModal">
                    <span class="iconify icon-normal me-2" data-icon="solar:add-square-linear" style="font-size: 28px;"></span>
                </button>
            </div>
            <div class="row">
                {% for ressource in ressources %}
                <div class="col-md-6 col-lg-4 mb-0.5">
                    <div class="card shadow-sm border-0">
                        <div class="card-body d-flex justify-content-between align-items-center">
                            <div>
                                {% if ressource.file %}
                                <a href="{{ ressource.file.url }}" download="" class="fw-bold text-dark">
                                    <span class="iconify me-2" data-icon="solar:file-check-linear" style="font-size: 24px; color: #635bff"></span>
                                    {{ ressource.titre }}
                                </a>
                                {% elif ressource.video_url %}
                                <a href="{{ ressource.video_url }}" target="_blank" class="fw-bold text-dark">
                                    <span class="iconify me-2" data-icon="solar:chat-round-video-linear" style="font-size: 24px; color: #635bff"></span>
                                    {{ ressource.titre }}
                                </a>
                                {% elif ressource.url %}
                                <a href="{{ ressource.url }}" target="_blank" class="fw-bold text-dark">
                                    <span class="iconify me-2" data-icon="solar:link-circle-linear" style="font-size: 24px; color: #635bff"></span>
                                    {{ ressource.titre }}
                                </a>
                                {% endif %}
                            </div>
                            
                            <!-- Delete Button -->
                            <button class="btn-indisplay" data-bs-toggle="modal" data-bs-target="#deleteRessourceModal{{ ressource.id }}">
                                <span class="iconify icon-delete" data-icon="solar:trash-bin-2-linear" style="font-size: 24px;"></span>
                            </button>
                        </div>
                    </div>
                </div>
        
                <!-- Delete Confirmation Modal -->
                <div class="modal fade" id="deleteRessourceModal{{ ressource.id }}" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content" style="border: none; border-radius: 15px; overflow: hidden;">
                            <div class="modal-header text-white" style="background-color: #635bff;">
                                <h5 class="modal-title" id="deleteModalLabel">Confirmer la suppression</h5>
                                <button type="button" class="btn-close custom-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                Êtes-vous sûr de vouloir supprimer cette ressource ?
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-ret" data-bs-dismiss="modal">Annuler</button>
                                <form method="post" action="{% url 'delete_ressource' ressource.id %}">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-danger raduise-for-all">Supprimer</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
        
                {% empty %}
                <div class="col-12 text-center text-muted">
                    <p>Aucune ressource disponible.</p>
                </div>
                {% endfor %}
            </div>
            <!-- Add Ressource Modal -->
        <div class="modal fade" id="addRessourceModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content" style="border: none; border-radius: 15px; overflow: hidden;">
                    <div class="modal-header text-white" style="background-color: #635bff;">
                        <h5 class="modal-title">Ajouter Ressource</h5>
                        <button type="button" class="btn-close custom-close" data-bs-dismiss="modal" aria-label="Close"></button>

                    </div>
                    <div class="modal-body">
                        <form method="post" action="{% url 'add_ressource' projet.id %}" enctype="multipart/form-data">
                            {% csrf_token %}
                            
                            <!-- Titre -->
                            <div class="mb-3">
                                <label class="form-label ml-4">Titre</label>
                                <input type="text" name="titre" class="form-control raduise-for-all" required>
                            </div>
                        
                            <!-- Resource Type Buttons -->
                            <div class="mb-3">
                                <label class="form-label ml-4">Type de ressource</label>
                                <div class="btn-group ml-2" role="group" aria-label="Resource Type">
                                    <button type="button" class="btn btn-res" id="fileBtn" style="border-radius: 12px;">Fichier</button>
                                    <button type="button" class="btn btn-res" id="videoBtn" style="border-radius: 12px;">Lien Vidéo</button>
                                    <button type="button" class="btn btn-res" id="urlBtn" style="border-radius: 12px;">Lien</button>
                                </div>
                            </div>
                        
                            <!-- Hidden Inputs (will be shown dynamically) -->
                            <div id="fileInput" class="mb-3 d-none">
                                <label class="form-label">Ressource (Fichier)</label>
                                <input type="file" name="file" class="form-control raduise-for-all">
                            </div>
                        
                            <div id="videoInput" class="mb-3 d-none">
                                <label class="form-label">Lien Vidéo</label>
                                <input type="url" name="video_url" class="form-control raduise-for-all">
                            </div>
                        
                            <div id="urlInput" class="mb-3 d-none">
                                <label class="form-label">Lien</label>
                                <input type="url" name="url" class="form-control raduise-for-all">
                            </div>
                        
                            <!-- Submit Button -->
                            <button type="submit" class="btn btn-modal-style">Ajouter</button>
                        </form>
                        
                        <!-- JavaScript to Handle Input Display and Button Selection -->
                        <script>
                            // Function to reset the selected button styles
                            function resetButtonStyles() {
                                let buttons = document.querySelectorAll('.btn-group button');
                                buttons.forEach(button => {
                                    button.classList.remove('selected-btn');
                                });
                            }
                        
                            document.getElementById("fileBtn").addEventListener("click", function() {
                                resetButtonStyles(); // Reset styles
                                this.classList.add('selected-btn'); // Add selected style
                                // Hide all input fields first
                                document.getElementById("fileInput").classList.remove("d-none");
                                document.getElementById("videoInput").classList.add("d-none");
                                document.getElementById("urlInput").classList.add("d-none");
                            });
                        
                            document.getElementById("videoBtn").addEventListener("click", function() {
                                resetButtonStyles(); // Reset styles
                                this.classList.add('selected-btn'); // Add selected style
                                // Hide all input fields first
                                document.getElementById("fileInput").classList.add("d-none");
                                document.getElementById("videoInput").classList.remove("d-none");
                                document.getElementById("urlInput").classList.add("d-none");
                            });
                        
                            document.getElementById("urlBtn").addEventListener("click", function() {
                                resetButtonStyles(); // Reset styles
                                this.classList.add('selected-btn'); // Add selected style
                                // Hide all input fields first
                                document.getElementById("fileInput").classList.add("d-none");
                                document.getElementById("videoInput").classList.add("d-none");
                                document.getElementById("urlInput").classList.remove("d-none");
                            });
                        </script>

                        
                        
                        
                    </div>
                </div>
            </div>
        </div>

            
        </div>

        


        <div id="groupes-view" style="display: none;">
            <h5 class="fw-bold text-dark text-center mb-3">
                <span class="iconify me-2" data-icon="solar:users-group-rounded-linear" style="font-size: 24px;"></span>
                Groupes
            </h5>
        
            <div class="container">
                <div class="row">
                    {% for groupe in groupes %}
                    <div class="col-md-6 col-lg-4 mb-1">
                        <div class="card shadow-lg border-0 rounded-3 transition-all">
                            <div class="card-body">
                                <h6 class="fw-bold text-primary d-flex align-items-center">
                                    <span class="iconify me-2" data-icon="solar:user-group-rounded-bold" style="font-size: 20px;"></span>
                                    {{ groupe.nom_groupe }}
                                </h6>
                                <p class="mb-1"><strong>Membres :</strong> {{ groupe.nbr_membre }}</p>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="col-12 text-center text-muted">
                        <p>Aucun groupe n'a été créé.</p>
                    </div>
                    {% endfor %}
                </div>
                
            </div>
        </div>
        

    </div>
    <script>
        function changeContent(view, button) {
    // Hide all sections
    document.getElementById('default-view').style.display = 'none';
    document.getElementById('instruction-view').style.display = 'none';
    document.getElementById('announce-view').style.display = 'none';
    document.getElementById('ressources-view').style.display = 'none';
    document.getElementById('groupes-view').style.display = 'none';

    // Show selected view
    if (view === 'instruction') {
        document.getElementById('instruction-view').style.display = 'block';
    } else if (view === 'announce') {
        document.getElementById('announce-view').style.display = 'block';
    } else if (view === 'ressource') {
        document.getElementById('ressources-view').style.display = 'block';
    } else if (view === 'groupes') {
        document.getElementById('groupes-view').style.display = 'block';
    } else {
        document.getElementById('default-view').style.display = 'block';
    }

    // Remove 'selected1' class from all buttons
    let buttons = document.querySelectorAll('.btn-dashboard');
    buttons.forEach(function(btn) {
        btn.classList.remove('selected1');
    });

    // Add 'selected1' class to the clicked button
    button.classList.add('selected1');
}

// Set "Projets" as default on page load
window.onload = function() {
    document.getElementById("default-btn").click();
};



    </script>
</div>
</div>



{% endblock content %}
