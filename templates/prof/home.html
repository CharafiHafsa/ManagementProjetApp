{% extends 'prof/base.html' %}
{% load static %}
{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold">My Classes</h2>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createClassModal">
            + Create New Class
        </button>
    </div>
    <div class="row">
        <!-- Sidebar for class list -->
        <div class="col-md-3">
            <div class="list-group" id="classList">
                {% for class in classes %}
                    <a href="#" class="list-group-item list-group-item-action class-item" data-class-id="{{ class.id }}">
                        {{ class.nom_classe }}
                    </a>
                {% endfor %}
            </div>
        </div>
        
        <!-- Global Statistics -->
        <div class="col-md-3">
            <div class="card p-3">
                <h5>Global Statistics</h5>
                <p>Total Classes: {{ total_classes }}</p>
                <p>Total Students: {{ total_students }}</p>
                <p>Total Projects: {{ total_projects }}</p>
            </div>
        </div>
        
        <!-- Class-specific statistics -->
        <div class="col-md-6">
            <div class="card p-3" id="classStatistics">
                <h5>Select a class to view details</h5>
                <p id="studentsCount">Students: -</p>
                <p id="projectsCount">Projects: -</p>
            </div>
        </div>
        <script>
            document.querySelectorAll(".class-item").forEach(item => {
    item.addEventListener("click", function(event) {
        event.preventDefault();
        const class_id = this.dataset.classId;  // Ensure it's the correct case
        console.log("Class ID:", class_id);  // Debugging line

        fetch(`/get_class_stats/${class_id}/`)  // Endpoint to fetch class stats
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch class statistics');
                }
                return response.json();
            })
            .then(data => {
                document.getElementById("studentsCount").innerText = `Students: ${data.students}`;
                document.getElementById("projectsCount").innerText = `Projects: ${data.projects}`;
            })
            .catch(error => {
                console.error(error);
                // Handle the error, e.g., display a message to the user
                document.getElementById("studentsCount").innerText = 'Error fetching statistics';
                document.getElementById("projectsCount").innerText = 'Error fetching statistics';
            });
    });
});

            </script>
    </div>
</div>

<!-- Bootstrap Modal for Creating a New Class -->
<div class="modal fade" id="createClassModal" tabindex="-1" aria-labelledby="createClassModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createClassModalLabel">Create New Class</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="createClassForm" method="POST">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="className" class="form-label">Class Name</label>
                        <input type="text" class="form-control" id="className" name="nom_classe" required>
                    </div>
                    <div class="mb-3">
                        <label for="subject" class="form-label">Subject</label>
                        <input type="text" class="form-control" id="subject" name="subject" required>
                    </div>
                    <div class="text-end">
                        <button type="submit" class="btn btn-primary">Create Class</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


{% endblock content %}
